<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Home Chat UI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes textPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    .animate-text-pulse {
      animation: textPulse 3s ease-in-out infinite;
    }
    .hidden { display: none; }
  </style>
</head>
<body class="bg-gradient-to-tr from-white via-sky-100 to-blue-50 min-h-screen font-sans text-gray-800">

  <div class="relative max-w-[1920px] mx-auto px-4 py-4 overflow-hidden">
    <div class="absolute inset-0 opacity-10 animate-pulse bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-pink-200 via-blue-200 to-indigo-100 blur-2xl"></div>

    <!-- Header -->
    <div class="relative z-10 flex justify-between items-center mb-4">
      <div class="flex items-center gap-3 text-xl font-extrabold text-sky-600 drop-shadow-sm tracking-wide uppercase">
        <div class="w-4 h-4 rounded-full bg-gradient-to-r from-pink-400 to-blue-500 animate-pulse"></div>
        <span class="text-[24px] font-bold bg-gradient-to-r from-fuchsia-500 via-sky-500 to-indigo-600 bg-clip-text text-transparent animate-text-pulse">
          Think â€¢ Feel â€¢ Share
        </span>
      </div>
      <button onclick="toggleSettings()" class="text-sm bg-gray-200 px-3 py-1 rounded-full font-medium">âš™ï¸ Settings</button>
    </div>

    <!-- Tabs -->
    <div class="relative z-10 flex gap-3 text-xs mb-4 border-b border-gray-300 pb-2 overflow-x-auto">
      <button onclick="activateTab('chats')" id="tab-chats" class="bg-sky-500 text-white px-3 py-1 rounded-full font-medium">ğŸ’¬ Chats</button>
      <button onclick="activateTab('contacts')" id="tab-contacts" class="bg-sky-100 text-gray-700 px-3 py-1 rounded-full hover:bg-sky-200">ğŸ“‡ Contacts</button>
      <button onclick="activateTab('status')" id="tab-status" class="bg-sky-100 text-gray-700 px-3 py-1 rounded-full hover:bg-sky-200">ğŸŸ¢ Status</button>
      <button onclick="activateTab('calls')" id="tab-calls" class="bg-sky-100 text-gray-700 px-3 py-1 rounded-full hover:bg-sky-200">ğŸ“ Calls</button>
      <button onclick="activateTab('profile')" id="tab-profile" class="bg-sky-100 text-gray-700 px-3 py-1 rounded-full hover:bg-sky-200">ğŸ‘¤ Profile</button>
      <button onclick="activateTab('ai')" id="tab-ai" class="bg-sky-100 text-gray-700 px-3 py-1 rounded-full hover:bg-sky-200">Menu</button>
    </div>

    <!-- Settings -->
    <div id="settingsPanel" class="absolute top-[140px] right-6 w-[300px] bg-white rounded-lg shadow-lg p-4 border border-gray-200 hidden z-50">
      <h2 class="text-lg font-semibold mb-2">âš™ï¸ Settings</h2>
      <ul class="grid grid-cols-2 gap-2 text-sm">
        <li class="bg-sky-50 p-2 rounded shadow-sm hover:bg-sky-100 cursor-pointer">Account</li>
        <li class="bg-sky-50 p-2 rounded shadow-sm hover:bg-sky-100 cursor-pointer">Privacy</li>
        <li class="bg-sky-50 p-2 rounded shadow-sm hover:bg-sky-100 cursor-pointer">Notifications</li>
        <li class="bg-sky-50 p-2 rounded shadow-sm hover:bg-sky-100 cursor-pointer">Chats</li>
        <li class="bg-sky-50 p-2 rounded shadow-sm hover:bg-sky-100 cursor-pointer">Linked Devices</li>
        <li class="bg-sky-50 p-2 rounded shadow-sm hover:bg-sky-100 cursor-pointer">Storage</li>
        <li class="bg-sky-50 p-2 rounded shadow-sm hover:bg-sky-100 cursor-pointer">Help</li>
        <li class="bg-sky-50 p-2 rounded shadow-sm hover:bg-sky-100 cursor-pointer">ğŸ“Œ Pin Chats</li>
        <li class="bg-sky-50 p-2 rounded shadow-sm hover:bg-sky-100 cursor-pointer">ğŸ—„ï¸ Archive Chats</li>
        <li class="bg-sky-50 p-2 rounded shadow-sm hover:bg-sky-100 cursor-pointer">ğŸ”• Mute Conversations</li>
        <li class="bg-sky-50 p-2 rounded shadow-sm hover:bg-sky-100 cursor-pointer">ğŸ—‘ï¸ Delete/Clear Chats</li>
        <li class="bg-sky-50 p-2 rounded shadow-sm hover:bg-sky-100 cursor-pointer">â­ Starred Messages</li>
      </ul>
    </div>
 <div>
     <!-- Horizontal Section: AI + Input -->
<!-- Main Horizontal Flex Container -->
<div class="relative z-10 flex h-[calc(100vh-130px)] overflow-hidden">
  <!-- LEFT SIDEBAR: SCROLLABLE AI FEATURES -->
  <div class="w-1/3 overflow-y-auto bg-white p-6 border-r border-gray-300">
    <h2 class="text-xl font-bold text-purple-600 mb-4">AI Smart Features</h2>
    <div class="flex flex-col gap-3 text-sm">
      <button class="bg-yellow-100 hover:bg-yellow-200 transition-colors duration-300 px-1 py-2 rounded-md">ğŸ§  AI Story Writer</button>
      <button class="bg-purple-100 hover:bg-purple-200 transition-colors duration-300 px-4 py-2 rounded-md">ğŸ’¡ AI Content Generator</button>
      <button class="bg-green-100 hover:bg-green-200 transition-colors duration-300 px-4 py-2 rounded-md">ğŸª„ AI Message Rewriter</button>
      <button class="bg-orange-100 hover:bg-orange-200 transition-colors duration-300 px-4 py-2 rounded-md">ğŸ¤– Smart Auto-Replies Bar</button>
      <button class="bg-yellow-100 hover:bg-yellow-200 transition-colors duration-300 px-4 py-2 rounded-md">ğŸ“ Quick Draft Generator</button>
      <button class="bg-purple-100 hover:bg-purple-200 transition-colors duration-300 px-4 py-2 rounded-md">ğŸ”Š Text-to-Voice Playback</button>
      <button class="bg-green-100 hover:bg-green-200 transition-colors duration-300 px-4 py-2 rounded-md">ğŸ“¤ File Upload</button>
    </div>
  </div>

  <!-- RIGHT SIDE: CHAT AREA (STATIC) -->
  <div class="w-2/3 h-full flex flex-col justify-end p-6 bg-blue-50">
    <div class="space-y-2 relative">
      
      <!-- CHAT INPUT -->
      <div class="bg-white rounded-full shadow-lg flex items-center px-4 py-2 gap-3 border border-gray-300">
        <button class="text-xl">ğŸ˜€</button>
        <input
          type="text"
          placeholder="Type a message..."
          oninput="handleTyping(event)"
          class="flex-1 text-sm outline-none bg-transparent"
        />
        <button class="text-xl">ğŸ“</button>
        <button class="text-xl">ğŸ™ï¸</button>
        <button class="bg-sky-500 text-white text-sm px-4 py-1 rounded-full hover:bg-sky-600">Send</button>
      </div>
      <!-- ğŸŒ Language Input (Initially Hidden) -->
<input
  id="languageInput"
  type="text"
  placeholder="Enter language (e.g. Hindi)"
  class="hidden mt-2 px-3 py-1 border border-gray-300 rounded-md text-sm outline-none w-1/2"
/>


      <!-- âœ… SUGGESTION BOX -->
      <div id="rewriteSuggestions" class="absolute bottom-[72px] left-0 w-full bg-white border border-gray-300 rounded-lg shadow-xl p-4 space-y-2 hidden z-50">
        <div class="flex justify-between items-center mb-2">
          <h4 class="text-sm font-semibold text-gray-700">âœï¸ Suggestions</h4>
          <button onclick="hideSuggestions()" class="text-gray-500 hover:text-red-500 text-sm">âœ–ï¸</button>
        </div>
        <div id="suggestionList" class="flex flex-col gap-2 text-sm"></div>
      </div>

      <!-- âœ… TRANSLATION POPUP - moved outside to work independently -->
      <div id="translationPopup" class="absolute bottom-[150px] left-0 w-full bg-white border border-gray-300 rounded-lg shadow-xl p-4 space-y-2 hidden z-50">
        <div class="flex justify-between items-center mb-2">
          <h4 class="text-sm font-semibold text-gray-700">ğŸŒ Translated Suggestion</h4>
          <button onclick="hideTranslation()" class="text-gray-500 hover:text-red-500 text-sm">âœ–ï¸</button>
        </div>
        <div class="text-sm">
          <div><strong>Original:</strong> <span id="originalText" class="text-gray-700"></span></div>
          <div><strong>Translated:</strong> <span id="translatedText" class="text-sky-700"></span></div>
        </div>
        <div class="flex gap-2 mt-3">
          <button onclick="selectTranslation(true)" class="bg-green-500 hover:bg-green-600 text-white text-sm px-4 py-1 rounded-full">âœ… Use Translation</button>
          <button onclick="selectTranslation(false)" class="bg-gray-200 hover:bg-gray-300 text-sm px-4 py-1 rounded-full">âŒ Keep Original</button>
        </div>
      </div>

      <!-- TRANSLATE / PARAPHRASE BUTTONS -->
      <div class="flex gap-2 mt-2">
        <button id="translateBtn" onclick="toggleTool('translate')" class="bg-sky-100 text-gray-700 hover:bg-sky-200 px-4 py-1 rounded-full text-sm font-medium transition">ğŸŒ Translate</button>
        <button id="paraphraseBtn" onclick="toggleTool('paraphrase')" class="bg-sky-100 text-gray-700 hover:bg-sky-200 px-4 py-1 rounded-full text-sm font-medium transition">âœï¸ Paraphrase</button>
      </div>

    </div>
  </div>
</div>


    <div id="tabContent-ai" class="absolute top-[140px] right-6 w-[300px] bg-white rounded-xl p-4 shadow-xl space-y-2 border border-gray-200 hidden z-50">
      <h3 class="text-base font-semibold text-sky-700 mb-2">ğŸ“‚ Menu</h3>
      <ul class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
        <li class="bg-blue-50 p-2 rounded hover:bg-blue-100 cursor-pointer">ğŸ”Š Voice</li>
        <li class="bg-blue-50 p-2 rounded hover:bg-blue-100 cursor-pointer">ğŸ’¬ Chat</li>
        <li class="bg-blue-50 p-2 rounded hover:bg-blue-100 cursor-pointer">ğŸŸ¢ Status</li>
        <li class="bg-blue-50 p-2 rounded hover:bg-blue-100 cursor-pointer">ğŸ“ Calls</li>
        <li class="bg-blue-50 p-2 rounded hover:bg-blue-100 cursor-pointer">ğŸ“· Media</li>
      </ul>
    </div>

    <div id="tabContent-calls" class="absolute top-[140px] right-6 w-[300px] bg-white rounded-xl p-4 shadow-xl space-y-2 border border-gray-200 hidden z-50">
      <h3 class="text-base font-semibold text-sky-700 mb-2">ğŸ“ Recent Calls</h3>
      <div class="p-2 bg-blue-50 rounded hover:bg-blue-100 text-sm flex justify-between">
        <span>John Doe (ğŸ“ Voice)</span>
        <span class="text-xs text-gray-500">Today, 9:12 AM</span>
      </div>
      <div class="p-2 bg-blue-50 rounded hover:bg-blue-100 text-sm flex justify-between">
        <span>Future Friend (ğŸ“¹ Video)</span>
        <span class="text-xs text-gray-500">Yesterday, 6:33 PM</span>
      </div>
      <div class="p-2 bg-blue-50 rounded hover:bg-blue-100 text-sm flex justify-between">
        <span>AI Assistant (ğŸ“ Voice)</span>
        <span class="text-xs text-gray-500">2 days ago, 3:20 PM</span>
      </div>
    </div>

    <div id="tabContent-profile" class="absolute top-[140px] right-6 w-[300px] bg-white rounded-xl p-4 shadow-xl space-y-2 border border-gray-200 hidden z-50">
      <h3 class="text-base font-semibold text-sky-700 mb-2">ğŸ‘¤ Your Profile</h3>
      <div class="flex items-center gap-4">
        <div class="w-16 h-16 bg-gray-300 rounded-full"></div>
        <div class="flex-1">
          <input class="w-full mb-1 p-2 rounded border text-sm" value="Your Name" />
          <textarea class="w-full p-2 rounded border text-xs" rows="2">About you...</textarea>
        </div>
      </div>
    </div>

    
 
  <!-- JavaScript -->
  <script>
    let activeTabId = null;
function activateTab(tabId) {
  const tabs = ['chats', 'contacts', 'status', 'calls', 'profile', 'ai'];

  // If the clicked tab is already open â†’ close it
  if (activeTabId === tabId) {
    document.getElementById(`tabContent-${tabId}`)?.classList.add('hidden');
    document.getElementById(`tab-${tabId}`)?.classList.remove('bg-sky-500', 'text-white');
    document.getElementById(`tab-${tabId}`)?.classList.add('bg-sky-100', 'text-gray-700');
    activeTabId = null;
    return;
  }

  // Hide all tabs
  tabs.forEach(id => {
    document.getElementById(`tabContent-${id}`)?.classList.add('hidden');
    document.getElementById(`tab-${id}`)?.classList.remove('bg-sky-500', 'text-white');
    document.getElementById(`tab-${id}`)?.classList.add('bg-sky-100', 'text-gray-700');
  });

  // Show the new one
  document.getElementById(`tabContent-${tabId}`)?.classList.remove('hidden');
  document.getElementById(`tab-${tabId}`)?.classList.remove('bg-sky-100', 'text-gray-700');
  document.getElementById(`tab-${tabId}`)?.classList.add('bg-sky-500', 'text-white');

  activeTabId = tabId;
}

  
 

  function toggleTool(tool) {
    document.getElementById('translateBtn').className =
      'tool-btn bg-sky-100 text-gray-700 hover:bg-sky-200 px-4 py-1 rounded-full text-sm font-medium transition';
    document.getElementById('paraphraseBtn').className =
      'tool-btn bg-sky-100 text-gray-700 hover:bg-sky-200 px-4 py-1 rounded-full text-sm font-medium transition';

        const langInput = document.getElementById('languageInput');

    if (activeTool !== tool) {
      activeTool = tool;
      document.getElementById(`${tool}Btn`).className =
      'tool-btn bg-sky-600 text-white px-4 py-1 rounded-full text-sm font-medium transition';
      // Show input only for translate
    if (tool === 'translate') langInput.classList.remove('hidden');
    else langInput.classList.add('hidden');
  } else {
    activeTool = null;
    langInput.classList.add('hidden');
  }
}
  //setting
  let isSettingsOpen = false;
function toggleSettings() {
  const panel = document.getElementById('settingsPanel');
  const wasOpen = isSettingsOpen;

  // First close all tabs
  const tabs = ['chats', 'contacts', 'status', 'calls', 'profile', 'ai'];
  tabs.forEach(id => {
    document.getElementById(`tabContent-${id}`)?.classList.add('hidden');
    document.getElementById(`tab-${id}`)?.classList.remove('bg-sky-500', 'text-white');
    document.getElementById(`tab-${id}`)?.classList.add('bg-sky-100', 'text-gray-700');
  });

  // Then toggle settings
  if (wasOpen) {
    panel.classList.add('hidden');
  } else {
    panel.classList.remove('hidden');
  }

  isSettingsOpen = !wasOpen;
}
//
let activeTool = null;
let suggestionTimeout = null;

// ğŸ”§ Ensure this is defined to avoid ReferenceError
function hideSuggestions() {
  const box = document.getElementById('rewriteSuggestions');
  if (box) box.classList.add('hidden');
}

// âœï¸ Typing Handler
function handleTyping(event) {
  clearTimeout(suggestionTimeout);

  const input = event.target.value;
  if (!input.trim()) {
    hideSuggestions();
    return;
  }

  suggestionTimeout = setTimeout(() => {
    runAutoCorrectAndSuggest(input);
  }, 1000);
}

// ğŸ”„ Step 1: Autocorrect â†’ Step 2: Rewrite
async function runAutoCorrectAndSuggest(rawMessage) {
  try {
    const autoRes = await fetch('/api/autocorrect', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: rawMessage })
    });

    if (!autoRes.ok) throw new Error('Autocorrect failed');

    const autoData = await autoRes.json();
    const correctedMessage = autoData.corrected;

    document.querySelector('input[type="text"]').value = correctedMessage;

    const rewriteRes = await fetch('/api/rewrite', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: correctedMessage })
    });

    if (!rewriteRes.ok) throw new Error('Rewrite failed');

    const rewriteData = await rewriteRes.json();
    console.log("âœï¸ Rewrite response:", rewriteData.rewritten);

    showSuggestions(rewriteData.rewritten);

  } catch (error) {
    console.error('Autocorrect/Rewrite Error:', error);
    hideSuggestions(); // fallback if error
  }
}

// ğŸ’¬ Show Rewrite Suggestions
function showSuggestions(rawText) {
  const suggestionBox = document.getElementById('rewriteSuggestions');
  const list = document.getElementById('suggestionList');
  list.innerHTML = ''; // clear old

  const matches = {
    polite: rawText.match(/Polite:\s*(.*)/i),
    casual: rawText.match(/Casual:\s*(.*)/i),
    positive: rawText.match(/Positive:\s*(.*)/i),
  };

  let found = false;

  for (const [label, match] of Object.entries(matches)) {
    console.log(`ğŸ” Match for ${label}:`, match);
    if (match && match[1]) {
      found = true;

      const btn = document.createElement('button');
      btn.textContent = `${label[0].toUpperCase() + label.slice(1)}: ${match[1]}`;
      btn.className = 'text-left bg-sky-100 hover:bg-sky-200 px-3 py-1 rounded shadow-sm w-full';

      btn.onclick = async () => {
        const selectedText = match[1];
        document.querySelector('input[type="text"]').value = selectedText;
        hideSuggestions();

        if (activeTool === 'translate') {
          await runTranslatePopup(selectedText);
        }
      };

      list.appendChild(btn);
    }
  }

  if (found) {
    suggestionBox.classList.remove('hidden');
  } else {
    hideSuggestions();
  }
}

// ğŸŒ Translation logic
async function runTranslatePopup(original) {
 const lang = document.getElementById('languageInput')?.value.trim() || 'Hindi';
  try {
    
    const res = await fetch('/api/translate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: original, language: lang })
    });

    if (!res.ok) throw new Error('Translation failed');

    if (data.error && data.error.includes('quota')) {
      alert('âš ï¸ Translation limit exceeded. Please try again later or use a different provider.');
      return;
    }

    const data = await res.json();

    document.getElementById('originalText').textContent = original;
    document.getElementById('translatedText').textContent = data.translated;
    document.getElementById('translationPopup').classList.remove('hidden');
  } catch (e) {
    console.error("Translate popup failed:", e);
  }
}

function hideTranslation() {
  document.getElementById('translationPopup')?.classList.add('hidden');
  document.getElementById('rewriteSuggestions')?.classList.add('hidden');
}

function selectTranslation(useTranslated) {
  if (useTranslated) {
    const text = document.getElementById('translatedText')?.textContent;
    document.querySelector('input[type="text"]').value = text;
  }
  hideTranslation();
}

function toggleTool(tool) {
  const langInput = document.getElementById('languageInput');

  document.getElementById('translateBtn').className =
    'tool-btn bg-sky-100 text-gray-700 hover:bg-sky-200 px-4 py-1 rounded-full text-sm font-medium transition';
  document.getElementById('paraphraseBtn').className =
    'tool-btn bg-sky-100 text-gray-700 hover:bg-sky-200 px-4 py-1 rounded-full text-sm font-medium transition';

  if (activeTool !== tool) {
    activeTool = tool;
    document.getElementById(`${tool}Btn`).className =
      'tool-btn bg-sky-600 text-white px-4 py-1 rounded-full text-sm font-medium transition';

    // ğŸ§  Show language input only for "translate"
    if (tool === 'translate') langInput.classList.remove('hidden');
    else langInput.classList.add('hidden');
  } else {
    activeTool = null;
    langInput.classList.add('hidden');
  }
}


  </script>
</body>
</html>
